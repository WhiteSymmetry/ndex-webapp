<!--   debugging
<pre ng-show="message">
    {{message}}
</pre>
-->

<div id="divNetwork" ng-show="networkController.errors.length == 0" class='row'>
    <div class='col-md-3'>

        <div id="divNetworkHeadline" class="row">
                <h4><label>{{networkController.currentNetwork.name}}</label</h4>
        </div>

        <div class="row">
            <div id="divNetworkStats">
            <span>
                 <label>nodes:</label>
                <!--<span>{{networkController.currentSubnetwork.nodeCount}}</span> out of-->
                 <span>{{networkController.currentNetwork.nodeCount}}</span>
            </span>
            <span>
                 <label>edges:</label>
                <!--<span>{{networkController.currentSubnetwork.edgeCount}}</span> out of-->
                 <span>{{networkController.currentNetwork.edgeCount}}</span>
            </span>
            </div>
        </div>

        <div class='row text-success'>{{networkController.currentNetwork.visibility}}</div>
        
        <div class='row'>{{networkController.currentNetwork.description}}</div>

        <div class="btn-group row" dropdown is-open="status1.isopen" ng-show='networkController.isLoggedIn'>
            <button type="button" class="btn btn-primary dropdown-toggle">
                Actions <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li ng-show='networkController.isAdmin'><a>
                    <edit-network-summary-modal
                        ndex-data='networkController.currentNetwork'>
                        Edit Network
                    </edit-network-summary-modal>
                </a></li>
                <li ng-show='networkController.isAdmin'><a>
                    <create-export-network-task
                        ndex-data='networkController.currentNetwork'>
                        Export Network as File
                    </create-export-network-task>
                </a></li>
                <li><a>
                    <create-request-network 
                        ndex-data='networkController.currentNetwork'>
                        Ask for Access!
                    </create-request-network>
                </a></li>
                <li><a ng-click='networkController.saveSubnetwork()'>Save Current Subnetwork</a></li>
            </ul>
        </div>

        <div class="btn-group row" dropdown is-open="status2.isopen" ng-hide='networkController.isLoggedIn'>
            <button type="button" class="btn btn-primary dropdown-toggle">
                Actions <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a href>You must be logged in to operate on network</a></li>
            </ul>
        </div>

        <hr>

        <div class='row' id='provenanceCanvas'>
        </div>
    </div>

    <div class='col-md-9' ng-show='networkController.currentNetwork.visibility == "PUBLIC" || networkController.isAdmin'>

    <div class='row text-center'>
        <h4>Retrieved Subnetwork</h4>
            <span>
                 <label>nodes:</label>
                <span>{{networkController.currentSubnetwork.nodeCount}}</span>
            </span>
            <span>
                 <label>edges:</label>
                 <span>{{networkController.currentSubnetwork.edgeCount}}</span>
            </span>
    </div>

    <div class="row" id="canvas">
    </div>

    <div class="row">

        <form id="frmSearchNetwork" ng-submit="networkController.submitNetworkQuery()" class="form-inline pull-left">
            <div class="form-group">
            <input class="form-control" type="search" ng-model="networkController.searchString" placeholder="Network Terms" required />
            </div>
            <div class="form-group">
            <label>Depth:</label>
                </div>
            <div class="form-group">
            <span>
                <select class="form-control" id="" ng-model="networkController.searchDepth.value" ng-selected="1"
                    ng-options="searchDepth.value as searchDepth.name for searchDepth in networkController.searchDepths"required></select>
            </span>
            </div>

            <button type="submit" class="btn btn-default ">Run Query</button>
        </form>

    </div>

    <!-- begins tabbable section -->
    <div id="divNetworkTabs" class="row">

        <div ng-show="networkController.currentSubnetwork.edgeCount == 0">
            <strong>No results found that match your criteria.</strong>
        </div>
        <tabset ng-hide="networkController.currentSubnetwork.edgeCount == 0">
            <tab heading="Edges">
                <div id="divEdges">
                    <ul id="ulSubnetwork" ng-repeat="(id, edge) in networkController.currentSubnetwork.edges">

                        <li>
                            <strong>{{networkController.currentSubnetwork.nodeLabelMap[edge.subjectId]}}</strong>
                            <em>{{networkController.currentSubnetwork.terms[edge.predicateId].name}}</em>
                            <strong>{{networkController.currentSubnetwork.nodeLabelMap[edge.objectId]}}</strong>
                            <span ng-repeat='citation in edge.citations'>
                            <a ng-href="{{networkController.getCitation(citation)}}" target="_blank"><sup>
                            <span class='glyphicon glyphicon-book'></span>
                            </sup></a>
                            </span>

                            <!--<sup rel="tooltip">{{edgeFootnotes[edge]}}
                            </sup>-->

                        </li>
                        <!-- todo: aliases
                        <li class="TermAliases" ng-show="hasAliases">

                            <div>
                                Alias: <a target="_blank" data-bind="termAlias: $root.Network().terms()[$data]"></a>
                            </div>

                            <div>
                                Related: <a target="_blank" data-bind="termAlias: $root.Network().terms()[$data]"></a>
                            </div>

                        </li>-->

                    </ul>
                </div>
            </tab>
            <tab heading="Nodes">
                <div id="divNodes">
                    <ul id="ulSubnetwork" ng-repeat="node in networkController.currentSubnetwork.nodes">
                        <li style="cursor:pointer" ng-click="node.showAliases = !node.showAliases">
                            <strong>{{networkController.currentSubnetwork.nodeLabelMap[node.id]}}</strong>
                            <span ng-repeat='citation in node.citations'>
                            <a ng-href="{{networkController.getCitation(citation)}}" target="_blank"><sup>
                            <span class='glyphicon glyphicon-book'></span>
                            </sup></a>
                            </span>
                        </li>
                        <li style="background : white" ng-show="node.showAliases && (node.aliases.length > 0)">
                            <span>Aliases:</span>
                            <em ng-repeat='(key,alias) in node.aliases'>
                                {{networkController.currentSubnetwork.baseTerms[alias].name}}
                                <span ng-show='(node.aliases.length > 1) && (key < node.aliases.length-1)'>,</span>
                            </em>
                        </li>
                    </ul>
                </div>
            </tab>
            <!--<tab heading="Terms">
                <ul>
                    <li class="row">
                        <div class="col-md-3 col-md-offset-3">
                            <strong>Prefix</strong>
                        </div>
                        <div class="col-md-3"><strong>Base Terms</strong></div>
                    </li>
                </ul>
                <ul id="ulSubnetwork" ng-repeat="(index, term) in networkController.currentSubnetwork.termLabelMap">
                    <li class="row">
                        <div class="col-md-3 col-md-offset-3">
                        <strong>{{term.prefix}}</strong></div>
                        <div class="col-md-3">{{term.name}}</div>
                    </li>
                </ul>
            </tab>-->
        </tabset>

    </div>

    </div>

    <div class='col-md-9' ng-hide='networkController.currentNetwork.visibility == "PUBLIC" || networkController.isAdmin'>
    <br>
    <br>
    <p class='text-center'>You do not have access to this network</p>
    </div>

<!-- end tab content -->
</div>

<div class="container-fluid" ng-hide="networkController.validRequest.length == 0">
    <div class="row">
        <div class="col-md-6 col-md-offset-2" ng-repeat="message in networkController.errors">
            <p><strong>{{message.label}}</strong> {{message.error}}</p>
        </div>
    </div>
</div>


<script type="text/ng-template" id="queryContent.html">
    <div class="modal-body text-center">
        <img src="img/horizontal-loader.gif">
    </div>
    <div class="modal-footer">
        <button class="btn btn-sm btn-default" ng-click="networkController.cancel()">Cancel</button>
    </div>
</script>